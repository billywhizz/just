<!doctype html>
<title>just (shell)</title>
<style>
  html {
    background: #555;
  }
  .terminal {
    float: left;
    border: #000 solid 5px;
    font-family: monospace;
    font-size: 10pt;
    color: #f0f0f0;
    background: #000;
  }
  .terminal-cursor {
    color: #000;
    background: #f0f0f0;
  }
</style>
<script src="term.js"></script>
<script>
window.onload = function() {
  const sock = new WebSocket(window.location.href.replace('http', 'ws'))
  let term
  sock.onopen = () => {
    term = new Terminal({
      cols: 120,
      rows: 60,
      useStyle: true,
      screenKeys: true,
      cursorBlink: true,
      handler: e => {
        term.write(e.replace(/\n/g, '\r\n'))
      }
    })
    term.on('data', function(data) {
      sock.send(data)
    })
    term.on('title', function(title) {
      document.title = title
    })
    term.open(document.body)
    term.write('\x1b[31mWelcome to just!\x1b[m\r\n')
  }
  sock.onmessage = event => {
    term.write(`\r\n${event.data.replace(/\n/g, '\r\n')}`)
  }
  sock.onclose = () => {
    term.destroy()
  }
  sock.onerror = err => {
    console.error(err)
  }
  sock.onSecure = err => {
    console.log('onSecure')
  }
}
</script>
